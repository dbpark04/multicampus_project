# 전처리 결과 파일 구조

전처리 파이프라인 실행 후 생성되는 Parquet 파일들의 구조를 설명합니다.

---

## 생성되는 파일

1. **integrated_products_final.parquet** - 모든 상품 정보 통합
2. **detailed*stats/detailed_stats_category*{카테고리}.parquet** - 카테고리별 감성 키워드 통계
3. **partitioned*reviews/partitioned_reviews_category*{카테고리}.parquet** - 카테고리별 리뷰 데이터

---

## 1. integrated_products_final.parquet

**위치**: `data/processed_data/integrated_products_final.parquet`

**설명**: 모든 카테고리의 상품 정보를 통합한 메인 Parquet 파일

### 컬럼 구조

```python
[
    'product_id',              # str: "선크림_123"
    'product_name',            # str: 전체 상품명
    'brand',                   # str: 표준화된 브랜드명
    'category',                # str: 카테고리명
    'skin_type',               # str: 피부 타입
    'top_keywords',            # list[str]: 긍정 키워드 상위 5개
    'product_vector',          # list[float]: Word2Vec 벡터
    'recommend_score',         # float: 추천 점수
    'avg_rating_with_text',    # float: 텍스트 리뷰 평균 평점
    'avg_rating_without_text', # float: 텍스트 없는 리뷰 평균 평점
    'text_review_ratio',       # float: 텍스트 리뷰 비율
    'total_reviews'            # int: 총 리뷰 수
]
```

### 사용 예시

```python
import pandas as pd

df = pd.read_parquet('data/processed_data/integrated_products_final.parquet')

# 특정 카테고리 필터링
sunstick = df[df['category'] == '선스틱']

# 건성 피부 추천 상품
dry_skin = df[(df['skin_type'] == '건성') & (df['avg_rating_with_text'] >= 4.5)]
```

---

## 2. detailed*stats_category*{카테고리}.parquet

**위치**: `data/processed_data/detailed_stats/detailed_stats_category_{카테고리}.parquet`

**설명**: 카테고리별 감성 키워드 통계

### 컬럼 구조

```python
[
    'product_id',      # str: 상품 ID
    'word',            # str: 키워드
    'diff',            # float: TF-IDF 차이값
    'pos',             # float: 긍정 리뷰 비율
    'neg',             # float: 부정 리뷰 비율
    'pos_n',           # int: 긍정 리뷰 출현 횟수
    'neg_n',           # int: 부정 리뷰 출현 횟수
    'support',         # int: 총 출현 횟수
    'balanced_ratio',  # float: 균형 비율
    'score',           # float: 중요도 점수
    'sentiment_type'   # str: "positive" 또는 "negative"
]
```

### 파일 예시

- `detailed_stats_category_선크림.parquet`
- `detailed_stats_category_립스틱.parquet`
- `detailed_stats_category_마스카라.parquet`

### 사용 예시

```python
import pandas as pd

df = pd.read_parquet('data/processed_data/detailed_stats/detailed_stats_category_선크림.parquet')

# 긍정 키워드 상위 10개
top_positive = df[df['sentiment_type'] == 'positive'].nlargest(10, 'score')

# 부정 키워드 상위 10개
top_negative = df[df['sentiment_type'] == 'negative'].nlargest(10, 'score')
```

---

## 3. partitioned*reviews_category*{카테고리}.parquet

**위치**: `data/processed_data/partitioned_reviews/partitioned_reviews_category_{카테고리}.parquet`

**설명**: 카테고리별 리뷰 데이터

### 컬럼 구조

```python
[
    'product_id',      # str: 상품 ID
    'full_text',       # str: 리뷰 전문
    'title',           # str: 리뷰 제목
    'has_text',        # bool: 텍스트 여부
    'label',           # int: 감성 라벨 (1=긍정, 0=부정)
    'sentiment_score', # float: 감성 점수
    'word2vec',        # list[float]: Word2Vec 벡터
    'rating'           # int: 별점 (1~5)
]
```

### 파일 예시

- `partitioned_reviews_category_선크림.parquet`
- `partitioned_reviews_category_립스틱.parquet`
- `partitioned_reviews_category_마스카라.parquet`

### 사용 예시

```python
import pandas as pd

df = pd.read_parquet('data/processed_data/partitioned_reviews/partitioned_reviews_category_선크림.parquet')

# 텍스트 리뷰만 필터링
text_reviews = df[df['has_text'] == True]

# 특정 상품의 리뷰
product_reviews = df[df['product_id'] == '선크림_123']

# 긍정 리뷰만 추출
positive = df[df['label'] == 1]
```

---

## 파일 간 관계도

```
전처리 파이프라인 실행 (main.py)
        ↓
┌────────────────────────────────────────────┐
│ Phase 1-3: 토큰화 → Word2Vec → 벡터화     │
└────────────────────────────────────────────┘
        ↓
┌────────────────────────────────────────────┐
│ 3가지 Parquet 파일 생성                    │
├────────────────────────────────────────────┤
│ 1. integrated_products_final.parquet       │
│    - 상품 정보 + 통계                      │
│                                            │
│ 2. detailed_stats_category_*.parquet       │
│    - 카테고리별 감성 키워드                │
│                                            │
│ 3. partitioned_reviews_category_*.parquet  │
│    - 카테고리별 리뷰 데이터                │
└────────────────────────────────────────────┘
```

---

## 분석 목적별 추천 파일

| 목적             | 추천 파일                               |
| ---------------- | --------------------------------------- |
| 상품 추천 시스템 | integrated_products_final.parquet       |
| 리뷰 검색/분석   | partitioned*reviews_category*\*.parquet |
| 감성 키워드 분석 | detailed*stats_category*\*.parquet      |
| 텍스트 리뷰 분석 | partitioned_reviews (has_text=True)     |
| 평점 분석        | integrated_products_final (avg_rating)  |
| 카테고리별 통계  | detailed_stats + partitioned_reviews    |

---

## 데이터 조합 예시

```python
import pandas as pd

# 상품 정보 로드
products = pd.read_parquet('data/processed_data/integrated_products_final.parquet')

# 특정 카테고리의 리뷰 로드
reviews = pd.read_parquet('data/processed_data/partitioned_reviews/partitioned_reviews_category_선크림.parquet')

# 감성 키워드 로드
stats = pd.read_parquet('data/processed_data/detailed_stats/detailed_stats_category_선크림.parquet')

# 상품-리뷰 조인
merged = products.merge(reviews, on='product_id', how='inner')

# 텍스트 리뷰만 분석
text_only = reviews[reviews['has_text'] == True]
```
